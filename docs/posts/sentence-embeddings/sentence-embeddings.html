<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Neal Caren, Associate Professor, Department of Sociology, University of North Carolina, Chapel Hill">
<meta name="dcterms.date" content="2024-02-23">
<meta name="description" content="Using Sentence-Transformers to measure the distance between a concept and a text.">

<title>notes - Measuring text similarity with sentence embeddings</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="notes - Measuring text similarity with sentence embeddings">
<meta name="twitter:description" content="Using Sentence-Transformers to measure the distance between a concept and a text.">
<meta name="twitter:image" content="twins.webp">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nealcaren"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/haphazardsoc.bsky.social"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Measuring text similarity with sentence embeddings</h1>
                  <div>
        <div class="description">
          Using Sentence-Transformers to measure the distance between a concept and a text.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">sentence embeddings</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 23, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div id="cell-1" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pip install <span class="op">-</span>U <span class="op">--</span>q sentence<span class="op">-</span>transformers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="cell-2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer, util</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_colwidth'</span>, <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/nealcaren/anaconda3/envs/whisperplus/lib/python3.11/site-packages/transformers/utils/generic.py:441: UserWarning: torch.utils._pytree._register_pytree_node is deprecated. Please use torch.utils._pytree.register_pytree_node instead.
  _torch_pytree._register_pytree_node(</code></pre>
</div>
</div>
<div id="cell-3" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SentenceTransformer(<span class="st">'all-MiniLM-L6-v2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/nealcaren/anaconda3/envs/whisperplus/lib/python3.11/site-packages/transformers/utils/generic.py:309: UserWarning: torch.utils._pytree._register_pytree_node is deprecated. Please use torch.utils._pytree.register_pytree_node instead.
  _torch_pytree._register_pytree_node(
/Users/nealcaren/anaconda3/envs/whisperplus/lib/python3.11/site-packages/transformers/utils/generic.py:309: UserWarning: torch.utils._pytree._register_pytree_node is deprecated. Please use torch.utils._pytree.register_pytree_node instead.
  _torch_pytree._register_pytree_node(</code></pre>
</div>
</div>
<div id="cell-4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model.encode(<span class="st">'We study apples.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([ 7.25412294e-02,  2.94132698e-02, -1.04851276e-02,  7.10855499e-02,
       -1.60725769e-02, -1.44585697e-02,  2.01909002e-02, -1.64043065e-02,
        5.85170425e-02,  4.42925990e-02,  3.38043720e-02, -3.70339900e-02,
       -1.01375952e-02,  1.51030989e-02, -2.33681127e-02, -7.01107532e-02,
       -6.28457516e-02, -1.98269282e-02, -2.56151836e-02, -3.29240002e-02,
       -3.28812934e-02,  1.20462896e-02,  2.59449407e-02, -9.30627715e-03,
        3.87127437e-02,  5.07903211e-02,  1.87327876e-03, -3.24000195e-02,
       -3.31559330e-02, -2.26897225e-02, -3.54236215e-02,  5.46763092e-02,
        9.66718495e-02,  3.60654816e-02, -5.42746857e-02, -6.75004860e-03,
        1.40686721e-01, -5.24841994e-02,  2.66690422e-02, -1.14018116e-02,
       -5.27682193e-02,  7.28323534e-02,  2.73659322e-02,  1.07277647e-01,
        1.61659811e-02,  3.81597877e-02, -1.69903729e-02, -3.23689356e-02,
        2.42316276e-02,  6.92270622e-02, -7.24644810e-02,  5.75410959e-04,
       -2.30131280e-02, -6.04602210e-02,  2.60792784e-02,  6.71790168e-02,
        9.09342691e-02, -3.36206444e-02,  7.23590478e-02, -1.65215111e-03,
        3.39566097e-02, -8.45273733e-02, -4.85875309e-02,  3.91481146e-02,
        9.04154778e-03, -8.98436904e-02, -5.66358864e-02,  4.21869494e-02,
       -2.75326185e-02,  8.08383152e-03,  3.66940014e-02,  2.62768455e-02,
        4.43452112e-02,  8.13365355e-02,  4.25574370e-02,  4.02889028e-02,
        1.33797051e-02, -5.26551530e-02, -1.71313528e-03, -3.53252031e-02,
       -1.33084031e-02, -3.56830396e-02, -8.78533255e-03, -2.92915851e-04,
       -5.95996482e-03,  1.08087016e-02, -3.73279974e-02,  1.11694261e-02,
       -8.32256749e-02,  3.41632962e-02,  1.11821033e-02, -4.44804654e-02,
       -5.93070313e-02,  2.85391472e-02, -5.28932542e-05,  1.43566700e-02,
        7.79099949e-03, -4.66752164e-02,  3.37223820e-02,  1.38128072e-01,
       -2.48398129e-02,  6.67299479e-02,  4.20545265e-02,  6.46362547e-03,
       -2.01197024e-02, -4.62081917e-02, -7.40140006e-02, -6.16762936e-02,
        6.25649691e-02,  5.63399047e-02,  5.71039356e-02, -1.97048280e-02,
       -1.04044281e-01,  1.12997763e-01,  7.35701993e-02, -5.85305728e-02,
        5.75302951e-02,  2.13396046e-02,  2.31305137e-02, -1.74588244e-02,
       -1.42283470e-03,  9.98423249e-02, -5.42779267e-02, -4.08335775e-02,
        3.16505209e-02, -6.30080476e-02,  5.79967070e-03, -6.57705620e-33,
        9.47775226e-03, -2.89162844e-02,  5.21772802e-02,  4.72146124e-02,
        1.75573980e-03, -2.80149970e-02,  6.52783411e-03,  6.76577762e-02,
        1.11630604e-01, -5.42772980e-03, -1.63363609e-02,  1.93208605e-02,
       -6.67217327e-03,  3.95874586e-03,  6.84757829e-02, -4.26633768e-02,
       -5.80286346e-02,  4.60271128e-02, -6.45208359e-02, -1.97640937e-02,
       -4.20666821e-02, -1.40169218e-01,  1.41780432e-02, -4.24528383e-02,
       -7.28586018e-02, -4.38546352e-02,  2.99364813e-02, -1.22642733e-01,
        1.05384283e-01, -9.39285476e-03,  4.56614830e-02,  4.46087569e-02,
       -7.81959221e-02, -2.15675607e-02, -1.61162820e-02,  1.18166637e-02,
        1.05830543e-01,  4.55662869e-02,  2.54090354e-02,  7.13379355e-04,
       -4.73194495e-02,  6.20454252e-02,  1.28243357e-01, -1.05106169e-02,
        6.04844540e-02,  4.86876108e-02,  6.08739592e-02,  7.04808533e-02,
       -3.78209017e-02,  1.76480156e-03, -7.23417252e-02, -4.73359115e-02,
        3.92539166e-02, -5.92344292e-02, -2.03246195e-02,  1.21152870e-01,
        2.25762613e-02, -2.12923903e-02, -7.87275955e-02,  1.72557738e-02,
       -1.17437020e-02,  4.75608334e-02,  2.89987470e-03,  2.87241656e-02,
       -7.83866942e-02,  1.22669660e-01, -7.32923672e-02, -2.76942160e-02,
        3.90719483e-03,  5.07837161e-02, -1.27230436e-01, -1.96105265e-03,
        1.29499817e-02, -2.39144196e-03, -1.02660574e-01, -3.95029709e-02,
        2.90869810e-02,  1.89506123e-03, -1.57893542e-02, -1.35825286e-02,
       -1.47497458e-02, -7.59655535e-02, -2.41609924e-02, -4.64349203e-02,
       -5.03189899e-02,  1.03728287e-01,  5.30537264e-03, -4.08360064e-02,
        4.37239483e-02,  1.50352474e-02,  1.78553362e-03,  2.78608631e-02,
       -1.33840907e-02, -1.94217525e-02, -6.97820038e-02,  3.64022021e-33,
       -3.52125727e-02, -3.46545912e-02, -1.97930746e-02,  3.53415050e-02,
        4.72753681e-02, -3.01812422e-02, -2.71848068e-02, -4.41191671e-03,
       -5.37364073e-02, -3.98576930e-02, -5.23934960e-02,  2.20293589e-02,
       -1.31326532e-02,  3.97575926e-03,  5.15052769e-03, -5.09656556e-02,
        2.74809133e-02,  6.49610087e-02, -3.33442353e-02,  3.82365957e-02,
       -8.04736614e-02,  4.02408168e-02,  1.55164497e-02, -3.17362957e-02,
       -8.52044765e-03, -1.36113567e-02, -1.03016114e-02, -1.63739058e-03,
       -3.56106050e-02,  4.95722368e-02,  3.19658928e-02, -1.06780723e-01,
       -6.47186339e-02, -5.92985041e-02,  7.48166954e-03,  3.27526592e-02,
       -2.17823554e-02, -3.67993712e-02, -1.45561453e-02,  5.68174422e-02,
        5.13046794e-02,  2.38617416e-02, -5.04206121e-02,  7.14061782e-02,
        5.55717610e-02,  9.42208767e-02, -2.91015077e-02,  1.10552333e-01,
       -1.50970956e-02,  1.36306453e-02,  2.84949895e-02,  1.54124191e-02,
       -9.30073187e-02, -7.49932304e-02,  3.89047265e-02,  6.32112427e-03,
        1.68052688e-02, -5.48552349e-02, -4.07663062e-02,  3.40671390e-02,
       -2.44489089e-02, -6.63542328e-03,  1.33677274e-02,  4.33265902e-02,
       -6.07616976e-02, -2.95820832e-03, -8.81790649e-03,  3.45228761e-02,
       -4.97724488e-02,  4.87365052e-02,  5.39725199e-02,  2.30813660e-02,
       -6.28042817e-02, -1.07893415e-01, -4.70633470e-02,  2.30335053e-02,
       -1.66683551e-02, -6.54008314e-02, -5.05928211e-02,  3.11856903e-02,
        8.44117161e-03,  6.16906621e-02, -1.53189339e-02,  6.40073717e-02,
        2.83199176e-02,  2.28565577e-02,  3.77516486e-02,  2.01664753e-02,
       -4.26778495e-02, -1.64321400e-02, -7.81823099e-02, -3.34092714e-02,
        3.54452953e-02, -1.01244465e-01, -7.63411000e-02, -1.36826950e-08,
       -6.46132380e-02, -4.54020202e-02,  7.10007921e-02, -1.07585511e-03,
        9.78543423e-03,  4.50233184e-02, -7.06218481e-02,  7.65154064e-02,
        1.31740945e-03, -2.06936337e-02, -5.31158149e-02,  4.04155143e-02,
       -7.19135329e-02,  7.89430514e-02,  5.02120666e-02,  7.71357790e-02,
        9.33832824e-02,  7.45651722e-02, -4.75667641e-02, -5.17647667e-03,
       -4.44874056e-02,  3.04975566e-02, -6.90343650e-03,  8.24641958e-02,
       -1.22354254e-02,  6.76435754e-02,  6.36463240e-03,  2.63797827e-02,
        4.96475771e-02,  8.34565535e-02,  3.48740071e-02,  2.49225888e-02,
       -9.88677517e-02, -5.98776303e-02,  3.49258445e-03, -6.12113327e-02,
       -2.36107334e-02,  2.68156715e-02,  2.23525390e-02,  9.43851192e-03,
       -1.19599409e-01, -6.57922998e-02, -2.84594391e-02,  3.78113380e-03,
       -3.77423279e-02,  6.28536614e-03, -4.52296101e-02,  7.04570040e-02,
       -7.60547956e-03,  7.97596648e-02, -2.58326419e-02, -3.47822644e-02,
        8.89370292e-02,  8.53143539e-03,  4.75420151e-03,  1.21760555e-02,
        3.13673206e-02, -1.13887928e-01, -6.46701753e-02,  7.35506192e-02,
        9.01015177e-02, -3.20984498e-02,  4.94505614e-02, -1.10336766e-03],
      dtype=float32)</code></pre>
</div>
</div>
<div id="cell-5" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(model.encode(<span class="st">'We study apples.'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>384</code></pre>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> concept_string_sim(concept, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                       text</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    concept_emedding <span class="op">=</span> model.encode(concept)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> text.split():</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        word_embedding <span class="op">=</span> model.encode(word)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        similarity <span class="op">=</span> util.pytorch_cos_sim(concept_emedding, word_embedding)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Similarity between </span><span class="sc">{</span>word<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>concept<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>similarity<span class="sc">:.2f}</span><span class="ss">.'</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    text_embedding <span class="op">=</span> model.encode(text)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    similarity <span class="op">=</span> util.pytorch_cos_sim(concept_emedding, text_embedding)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Similarity between </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>concept<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>similarity<span class="sc">:.2f}</span><span class="ss">.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>concept_string_sim(<span class="st">'rock'</span>, <span class="st">'Grateful Dead show'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity between Grateful and rock is 0.21.
Similarity between Dead and rock is 0.40.
Similarity between show and rock is 0.34.
Similarity between Grateful Dead show and rock is 0.40.</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>concept_string_sim(<span class="st">'thankful attitude'</span>, <span class="st">'Grateful Dead show'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity between Grateful and thankful attitude is 0.50.
Similarity between Dead and thankful attitude is 0.23.
Similarity between show and thankful attitude is 0.20.
Similarity between Grateful Dead show and thankful attitude is 0.20.</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> string_string_sim(text1,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                      text2,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    text1_embedding <span class="op">=</span> model.encode(text1)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    text2_embedding <span class="op">=</span> model.encode(text2)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    similarity <span class="op">=</span> util.pytorch_cos_sim(text1_embedding, text2_embedding)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Similarity is </span><span class="sc">{</span>similarity<span class="sc">:.2f}</span><span class="ss">.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>string_string_sim(<span class="st">'We study revolutions.'</span>, <span class="st">'This paper examines social movements.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is 0.47.</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>string_string_sim(<span class="st">'We study revolutions.'</span>, <span class="st">'This paper examines health behaviors.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is 0.18.</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>string_string_sim(<span class="st">'We study revolutions.'</span>, <span class="st">'This paper examines social movements in Algeria during the 1970s.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is 0.36.</code></pre>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>movement_word_list<span class="op">=</span>[<span class="st">'social movement'</span>, <span class="st">'contentious politics'</span>, <span class="st">'mobilization'</span>,]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>movement_words <span class="op">=</span> <span class="st">', '</span>.join(movement_word_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>string_string_sim(movement_words,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'We study revolutions.'</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is 0.44.</code></pre>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>string_string_sim(movement_words,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'This paper examines health behaviors.'</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is 0.18.</code></pre>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>string_string_sim(movement_words,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'We study revolutions in Algeria.'</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is 0.42.</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>abstract_moby <span class="op">=</span> <span class="st">"Role exit is a complex process that can be especially complicated for extremists, whose identities are stigmatized. Such stigmatization often leads extremists to seek refuge in “free spaces” where they may insulate themselves from the mainstream and celebrate their ideology amongst likeminded individuals. Yet, stigma may also push those who desire to exit an extremist role to seek out their own free spaces where they can disengage from extremist ideology with others who wish to disengage. In this study, we analyze posts obtained from two Incel digital forums: a forum of active Incels and a forum of exiting Incels. We compared the ways that active and exiting Incels use free spaces to situate themselves inside or outside of this extremist community. Our analysis demonstrates that free spaces, which social movement scholars argue foster commitment among extremists, may offer exiting extremists insulation from active extremists while also keeping them tethered to hostile ideology."</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>string_string_sim(abstract_moby, movement_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is 0.36.</code></pre>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>abstract_sf<span class="op">=</span> <span class="st">'''All around the world, school-entry cohorts are organized on an annual calendar so that the age of students in the same cohort differs by up to one year. It is a well-established finding that this age gap entails a consequential (dis)advantage for academic performance referred to as the relative age effect (RAE). This study contributes to a recent strand of research that has turned to investigate the RAE on non-academic outcomes such as personality traits. An experimental setup is used to estimate the causal effect of monthly age on cognitive effort in a sample of 798 fifth-grade students enrolled in the Spanish educational system, characterized by strict enrolment rules. Participants performed three different real-effort tasks under three different incentive conditions: no rewards; material rewards; and material and status rewards. We observe that older students outwork their youngest peers by two-fifths of a standard deviation, but only when material rewards for performance are in place. Despite the previously reported higher taste for competition among the older students within a school-entry cohort, we do not find that the RAE on cognitive effort increases after inducing competition for peer recognition. Finally, the study also provides suggestive evidence of a larger RAE among boys and students from lower social strata. Implications for sociological research on educational inequality are discussed. To conclude, we outline policy recommendations such as implementing evaluation tools that nudge teachers toward being mindful of relative age differences.'''</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>string_string_sim(abstract_sf, movement_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Similarity is -0.04.</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_json(<span class="st">'https://raw.githubusercontent.com/nealcaren/notes/main/posts/abstracts/sociology-abstracts.json'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>movement_word_embedding <span class="op">=</span> model.encode(movement_words)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> string_embedding_sim(text1,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                      text2_embedding<span class="op">=</span>movement_word_embedding,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    text1_embedding <span class="op">=</span> model.encode(text1)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    similarity <span class="op">=</span> util.pytorch_cos_sim(text1_embedding, text2_embedding)[<span class="dv">0</span>][<span class="dv">0</span>].item()</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> similarity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>string_embedding_sim(abstract_moby )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>0.36133891344070435</code></pre>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'abstract_movement_similarity'</span>] <span class="op">=</span> df[<span class="st">'Abstract'</span>].<span class="bu">apply</span>(string_embedding_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'abstract_movement_similarity'</span>].hist(bins<span class="op">=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sentence-embeddings_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create quintiles</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Quintile'</span>] <span class="op">=</span> pd.qcut(df[<span class="st">'abstract_movement_similarity'</span>], <span class="dv">20</span>, labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Filter for the top quarter quintiles (quintiles 15-19)</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>top_half_quintiles <span class="op">=</span> df[df[<span class="st">'Quintile'</span>] <span class="op">&gt;=</span> <span class="dv">15</span>]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Display "Title" and "Source title" for a random sample of 5 rows within each top half quintile</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> quintile <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">19</span>, <span class="dv">14</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    sample <span class="op">=</span> top_half_quintiles[top_half_quintiles[<span class="st">'Quintile'</span>] <span class="op">==</span> quintile].sample(n<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Quintile </span><span class="sc">{</span>quintile <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    display(sample[[<span class="st">'Source title'</span>, <span class="st">'Title'</span>, <span class="st">'abstract_movement_similarity'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Quintile 20:
Quintile 19:
Quintile 18:
Quintile 17:
Quintile 16:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source title</th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">abstract_movement_similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5749</td>
<td>Qualitative Sociology</td>
<td>Legitimacy without Mobilization? How Social Justice Organizations Defend their Democratic Credentials</td>
<td>0.500987</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9191</td>
<td>Sociological Theory</td>
<td>Modernity and the Politics of Newness: Unraveling New Time in the Chinese Cultural Revolution, 1966 to 1968</td>
<td>0.470191</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7308</td>
<td>Qualitative Sociology</td>
<td>Becoming a Population: Seeing the State, Being Seen by the State, and the Politics of Eviction in Cape Town</td>
<td>0.425383</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">871</td>
<td>Social Forces</td>
<td>Environmental threats and political opportunities: Citizen activism in the North Bohemian coal basin</td>
<td>0.482557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4489</td>
<td>Theory and Society</td>
<td>Combining transition studies and social movement theory: towards a new research agenda</td>
<td>0.631707</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source title</th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">abstract_movement_similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9636</td>
<td>Social Problems</td>
<td>"Trans Enough": Examining the Boundaries of Transgender-Identity Membership</td>
<td>0.367395</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1123</td>
<td>Mobilization</td>
<td>A field-experimental study of emergent mobilization in online collective action</td>
<td>0.419390</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">248</td>
<td>Mobilization</td>
<td>Com/passionate protests: Fighting the deportation of asylum seekers</td>
<td>0.423252</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">457</td>
<td>Du Bois Review</td>
<td>Taking postracialism seriously: From movement mythology to racial formation</td>
<td>0.400696</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6373</td>
<td>Qualitative Sociology</td>
<td>Life on File: Archival Epistemology and Theory</td>
<td>0.365092</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source title</th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">abstract_movement_similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4577</td>
<td>City and Community</td>
<td>Performative Progressiveness: Accounting for New Forms of Inequality in the Gayborhood</td>
<td>0.343400</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8222</td>
<td>American Journal of Sociology</td>
<td>From the State to the Street: The Segregated Loss of Childcare and the Institutional Origins of Organizational Deprivation</td>
<td>0.327435</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1172</td>
<td>Sociological Perspectives</td>
<td>Differences in Public Perceptions and Leaders Perceptions on Hydraulic Fracturing and Shale Development</td>
<td>0.314416</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">839</td>
<td>Theory and Society</td>
<td>The theoretical costs of ignoring childhood: rethinking independence, insecurity, and inequality</td>
<td>0.334687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6857</td>
<td>Sociological Inquiry</td>
<td>The Culture of White Space, the Racialized Production of Meaning, and the Jamband Scene</td>
<td>0.329481</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source title</th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">abstract_movement_similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8118</td>
<td>Sociological Inquiry</td>
<td>Assessing Variation and Change in Newspaper Portrayals of Muslims: The influence of the Trump Election and Differences across the United States in Local and National Papers*</td>
<td>0.289904</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8015</td>
<td>Sociological Forum</td>
<td>Fill the Earth and Subdue It: Christian Nationalism, Ethno-Religious Threat, and Nationalist Pronatalism</td>
<td>0.292034</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6354</td>
<td>Sociological Forum</td>
<td>The Outsider’s Edge: Geography, Gender, and Sexuality in the Local Color Movement</td>
<td>0.291755</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8028</td>
<td>Social Psychology Quarterly</td>
<td>Exchange and the Creation of Trust and Solidarity across Cultures</td>
<td>0.290860</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1287</td>
<td>American Sociological Review</td>
<td>The Historical Demography of Racial Segregation</td>
<td>0.287827</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source title</th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">abstract_movement_similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">7416</td>
<td>Du Bois Review</td>
<td>Zainichi Koreans, African Americans, and the Racial Politics of Comparison</td>
<td>0.280232</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5654</td>
<td>Sociological Perspectives</td>
<td>Who Doesn’t Want Democracy? A Multilevel Analysis of Elite and Mass Attitudes</td>
<td>0.278912</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6470</td>
<td>Symbolic Interaction</td>
<td>The Everyday Drama of Coproduction in Community Mental Health Services: Analyzing Welfare Workers' Performance as the “Undercover Agent”</td>
<td>0.270104</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5474</td>
<td>Symbolic Interaction</td>
<td>“Jesus Would Turn the Tables Over”: Five Dimensions of Authenticity Applied to Countercultural Christianity</td>
<td>0.272482</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">424</td>
<td>City and Community</td>
<td>Territories of concern: Vacant housing and perceived disorder on three suburban blocks</td>
<td>0.272447</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'Source title'</span>)[<span class="st">'abstract_movement_similarity'</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">True</span>).plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sentence-embeddings_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-27" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by 'Source Title' and find the index of the max 'abstract_movement_similarity' in each group</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> df.groupby(<span class="st">'Source title'</span>)[<span class="st">'abstract_movement_similarity'</span>].idxmax()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the DataFrame to keep only the rows with the highest 'abstract_movement_similarity' in each group</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>highest_values_df <span class="op">=</span> df.loc[idx]</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>display <span class="op">=</span> [<span class="st">'Source title'</span>, <span class="st">'Title'</span>, <span class="st">'abstract_movement_similarity'</span>]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>highest_values_df[display].sort_values(by<span class="op">=</span><span class="st">'abstract_movement_similarity'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source title</th>
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">abstract_movement_similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1923</td>
<td>Mobilization</td>
<td>Social movements in an age of participation</td>
<td>0.702846</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">433</td>
<td>American Journal of Sociology</td>
<td>Issue bricolage: Explaining the configuration of the social movement sector, 1960–1995</td>
<td>0.680012</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3768</td>
<td>Social Problems</td>
<td>Economic breakdown and collective action</td>
<td>0.660584</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4400</td>
<td>Sociology of Race and Ethnicity</td>
<td>The Anti-oppressive Value of Critical Race Theory and Intersectionality in Social Movement Study</td>
<td>0.652746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5221</td>
<td>Social Currents</td>
<td>Assessing the Explanatory Power of Social Movement Theories across the Life Course of the Civil Rights Movement</td>
<td>0.641801</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8064</td>
<td>Sociological Perspectives</td>
<td>Policy Relay: How Affirmative Consent Went from Controversy to Convention</td>
<td>0.632110</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4489</td>
<td>Theory and Society</td>
<td>Combining transition studies and social movement theory: towards a new research agenda</td>
<td>0.631707</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6325</td>
<td>Social Forces</td>
<td>Pathways to modes of movement participation: Micromobilization in the nashville civil rights movement</td>
<td>0.629331</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2482</td>
<td>American Sociological Review</td>
<td>Tactical Innovation in Social Movements: The Effects of Peripheral and Multi-Issue Protest</td>
<td>0.616886</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6201</td>
<td>City and Community</td>
<td>Confronting Scale: A Strategy of Solidarity in Urban Social Movements, New York City and Beyond</td>
<td>0.606433</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1474</td>
<td>Sociological Forum</td>
<td>Be Careful What You Wish For: The Ironic Connection Between the Civil Rights Struggle and Today's Divided America</td>
<td>0.596116</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4818</td>
<td>Qualitative Sociology</td>
<td>Life Histories and Political Commitment in a Poor People’s Movement</td>
<td>0.581159</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5574</td>
<td>Sociological Theory</td>
<td>Overflowing Channels: How Democracy Didn’t Work as Planned (and Perhaps a Good Thing It Didn’t)</td>
<td>0.561438</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1278</td>
<td>Sociological Science</td>
<td>Dissecting The Spirit Of Gezi: Influence vs. selection in the occupy Gezi movement</td>
<td>0.559833</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3367</td>
<td>Social Science Research</td>
<td>How social media matter: Repression and the diffusion of the Occupy Wall Street movement</td>
<td>0.559743</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4354</td>
<td>Sociological Inquiry</td>
<td>Practicing Gender and Race in Online Activism to Improve Safe Public Space in Sweden</td>
<td>0.557239</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7128</td>
<td>Symbolic Interaction</td>
<td>“Meet Them Where They Are”: Attentional Processes in Social Movement Listening</td>
<td>0.546802</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9150</td>
<td>Social Networks</td>
<td>How networks of social movement issues motivate climate resistance</td>
<td>0.531231</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4094</td>
<td>Work and Occupations</td>
<td>Renewed Activism for the Labor Movement: The Urgency of Young Worker Engagement</td>
<td>0.527430</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3722</td>
<td>Social Psychology Quarterly</td>
<td>Measuring Resonance and Dissonance in Social Movement Frames With Affect Control Theory</td>
<td>0.505426</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8292</td>
<td>Du Bois Review</td>
<td>REACTION to the BLACK CITY AS A CAUSE of MODERN CONSERVATISM</td>
<td>0.505141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4360</td>
<td>Sociological Methods and Research</td>
<td>Size Matters: Quantifying Protest by Counting Participants</td>
<td>0.504456</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7333</td>
<td>Gender and Society</td>
<td>Immigrant and Refugee Youth Organizing in Solidarity With the Movement for Black Lives</td>
<td>0.497979</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2597</td>
<td>Poetics</td>
<td>Political space and the space of polities: Doing politics across nations</td>
<td>0.487815</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">833</td>
<td>Sociology of Education</td>
<td>The Origins of Race-conscious Affirmative Action in Undergraduate Admissions: A Comparative Analysis of Institutional Change in Higher Education</td>
<td>0.465736</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8179</td>
<td>Journal of Marriage and Family</td>
<td>Central American immigrant mothers' narratives of intersecting oppressions: A resistant knowledge project</td>
<td>0.403927</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2628</td>
<td>Demography</td>
<td>Large-Scale Urban Riots and Residential Segregation: A Case Study of the 1960s U.S. Riots</td>
<td>0.347279</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7289</td>
<td>Journal of Health and Social Behavior</td>
<td>From Medicine to Health: The Proliferation and Diversification of Cultural Authority</td>
<td>0.344940</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>quantitative_words <span class="op">=</span> <span class="st">', '</span>.join([</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"surveys"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"experiments"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"quasi-experiments"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"regression analysis"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"statistical analysis"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"correlation"</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>quantitative_embedding <span class="op">=</span> model.encode(quantitative_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-29" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'abstract_quant_similarity'</span>] <span class="op">=</span> df[<span class="st">'Abstract'</span>].<span class="bu">apply</span>(string_embedding_sim, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                                                       text2_embedding<span class="op">=</span>quantitative_embedding)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'Source title'</span>)[<span class="st">'abstract_quant_similarity'</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">True</span>).plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sentence-embeddings_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming df is your DataFrame</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Pearson correlation coefficient</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> df[<span class="st">'abstract_quant_similarity'</span>].corr(df[<span class="st">'abstract_movement_similarity'</span>])</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the common range for both axes based on the min and max of both series</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>common_range <span class="op">=</span> [</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span>(df[<span class="st">'abstract_quant_similarity'</span>].<span class="bu">min</span>(), df[<span class="st">'abstract_movement_similarity'</span>].<span class="bu">min</span>()), </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span>(df[<span class="st">'abstract_quant_similarity'</span>].<span class="bu">max</span>(), df[<span class="st">'abstract_movement_similarity'</span>].<span class="bu">max</span>())</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the scatter plot with square dimensions</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))  <span class="co"># Makes the figure square in size</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">'abstract_quant_similarity'</span>], df[<span class="st">'abstract_movement_similarity'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the same range for both X and Y axes</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>plt.xlim(common_range)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>plt.ylim(common_range)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title with the correlation coefficient, formatted to two decimal places</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Scatter Plot of Quantitative vs. Movement Similarity</span><span class="ch">\n</span><span class="ss">Correlation: </span><span class="sc">{</span>correlation<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add x and y labels</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Abstract Quantitative Similarity'</span>)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Abstract Movement Similarity'</span>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the aspect ratio is equal to make the plot truly square</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>plt.gca().set_aspect(<span class="st">'equal'</span>, adjustable<span class="op">=</span><span class="st">'box'</span>)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sentence-embeddings_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>